local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local player = Players.LocalPlayer
local Character = player.Character or player.CharacterAdded:Wait()
local hrp = Character:WaitForChild("HumanoidRootPart")
local Backpack = player:WaitForChild("Backpack")

local AutoFarmNPC = false
local FarmRadius = 150 
local AutoSkillState={Z=false,X=false,C=false,V=false} 
local AutoHakiState=false 
local AutoDropItem = false 

-- Thêm biến Hotkey có thể tùy chỉnh
local Hotkey = Enum.KeyCode.RightControl
local HubVisible = true

-- CHỈ CÒN BIẾN GOD MODE
local GodModeState = false 

local ITEM_DROP_LIST = {
    ["Apple"] = true,
    ["Cantaloup"] = true,
    ["Cantaloupe"] = true, 
    ["Banana"] = true,
    ["Green Apple"] = true,
    ["Coconut"] = true,
    ["Pumpkin"] = true,
    ["Prickly Pear"] = true,
    ["Melon"] = true,
}

local function findDroppableItemInList()
    for _, item in ipairs(Backpack:GetChildren()) do
        if (item:IsA("Tool") or item:IsA("HopperBin")) and ITEM_DROP_LIST[item.Name] then 
            return item
        end
    end
    return nil
end

-- TỰ ĐỘNG CẬP NHẬT TRONG TRƯỜNG HỢP NHÂN VẬT CHẾT/TÁI SINH
player.CharacterAdded:Connect(function(newCharacter)
    Character = newCharacter
    hrp = Character:WaitForChild("HumanoidRootPart")
    
    -- Đảm bảo God Mode được bật lại sau khi tái sinh
    if GodModeState then
        task.wait(0.2) 
        -- God Mode sẽ được vòng lặp dưới đây xử lý tiếp
    end
end)


pcall(function()
    if player:FindFirstChild("PlayerGui") and player.PlayerGui:FindFirstChild("FruitHubUI") then
        player.PlayerGui.FruitHubUI:Destroy()
    end
end)

local PlayerGui = player:WaitForChild("PlayerGui", 5) 
if not PlayerGui then return end 

-- ===== PHẦN UI (Kích thước đã thu nhỏ & Độ mờ) =====
local MAIN_W, MAIN_H = 600, 380
local Sidebar_W = 130 
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FruitHubUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = PlayerGui

local Main = Instance.new("Frame")
Main.Name = "Main"
Main.Size = UDim2.new(0, MAIN_W, 0, MAIN_H)
Main.Position = UDim2.new(0.5, -MAIN_W/2, 0.12, 0) 
Main.BackgroundColor3 = Color3.fromRGB(24,24,28)
Main.BackgroundTransparency = 0.15 
Main.BorderSizePixel = 0
Main.Parent = ScreenGui
Instance.new("UICorner", Main).CornerRadius = UDim.new(0,12)

local shadow = Instance.new("UIStroke", Main)
shadow.Color = Color3.fromRGB(85, 170, 255)
shadow.Thickness = 2
shadow.Transparency = 0.6

local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1,0,0,32) 
TitleBar.Position = UDim2.new(0,0,0,0)
TitleBar.BackgroundColor3 = Color3.fromRGB(32,32,36)
TitleBar.BackgroundTransparency = 0.15 
TitleBar.BorderSizePixel = 0
TitleBar.Parent = Main
Instance.new("UICorner", TitleBar).CornerRadius = UDim.new(0,12)

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Size = UDim2.new(0.6,-10,1,0)
TitleLabel.Position = UDim2.new(0,10,0,0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.Font = Enum.Font.GothamBold
TitleLabel.Text = "NTBA • Farm Hub (V20.4)"
TitleLabel.TextSize = 15
TitleLabel.TextColor3 = Color3.fromRGB(170, 255, 255)
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleBar

local AuthorLabel = Instance.new("TextLabel")
AuthorLabel.Size = UDim2.new(0.3,-10,1,0)
AuthorLabel.Position = UDim2.new(0.7,10,0,0)
AuthorLabel.BackgroundTransparency = 1
AuthorLabel.Font = Enum.Font.Gotham
AuthorLabel.Text = "Author: NTBA"
AuthorLabel.TextSize = 12
AuthorLabel.TextColor3 = Color3.fromRGB(160,160,160)
AuthorLabel.TextXAlignment = Enum.TextXAlignment.Right
AuthorLabel.Parent = TitleBar

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0,30,0,24) 
CloseBtn.Position = UDim2.new(1,-38,0,4)
CloseBtn.BackgroundColor3 = Color3.fromRGB(180,60,60)
CloseBtn.Text = "X"
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.TextSize = 13
CloseBtn.TextColor3 = Color3.fromRGB(255,255,255)
CloseBtn.BorderSizePixel = 0
CloseBtn.BackgroundTransparency = 0.1 
Instance.new("UICorner", CloseBtn).CornerRadius = UDim.new(0,6)
CloseBtn.Parent = TitleBar
CloseBtn.MouseButton1Click:Connect(function() 
    ScreenGui:Destroy() 
    script:Destroy() 
end)

do
    local dragging = false
    local dragStart, startPos
    TitleBar.InputBegan:Connect(function(input)
        if input.UserInputType==Enum.UserInputType.MouseButton1 then
            dragging=true
            dragStart=input.Position
            startPos=Main.Position
            input.Changed:Connect(function()
                if input.UserInputState==Enum.UserInputState.End then dragging=false end
            end)
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType==Enum.UserInputType.MouseMovement then
            local delta=input.Position - dragStart
            Main.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
        end
    end)
end

-- Xử lý Hotkey (Dùng biến Hotkey đã được khai báo)
UserInputService.InputBegan:Connect(function(input,gpe)
    if not gpe and input.KeyCode == Hotkey then
        HubVisible = not HubVisible
        ScreenGui.Enabled = HubVisible
    end
end)

local Sidebar = Instance.new("Frame")
Sidebar.Size = UDim2.new(0,Sidebar_W,1,-32) 
Sidebar.Position = UDim2.new(0,0,0,32)
Sidebar.BackgroundColor3 = Color3.fromRGB(36,36,38)
Sidebar.BackgroundTransparency = 0.15 
Sidebar.BorderSizePixel = 0
Sidebar.Parent = Main
Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0,10)

-- Danh sách tab đã được cập nhật
local tabs = {"AutoFarm","AutoNPC","AutoHaki","Drop","Utility","Settings"}
local tabButtons, panels = {}, {}

local SidebarLayout = Instance.new("UIListLayout", Sidebar)
SidebarLayout.Padding = UDim.new(0,6)
SidebarLayout.SortOrder = Enum.SortOrder.LayoutOrder
SidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
SidebarLayout.VerticalAlignment = Enum.VerticalAlignment.Top

local Panel_X_Start = Sidebar_W + 10 
local Panel_Y_Start = 32 + 10      
local Panel_W = MAIN_W - Sidebar_W - 20 
local Panel_H = MAIN_H - 32 - 20        

for i,name in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1,-10,0,32) 
    btn.BackgroundColor3 = Color3.fromRGB(44,44,46)
    btn.BackgroundTransparency = 0.2 
    btn.BorderSizePixel = 0
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 13
    btn.TextColor3 = Color3.fromRGB(220,220,220)
    btn.Text = name
    btn.Parent = Sidebar
    Instance.new("UICorner", btn).CornerRadius = UDim.new(0,6)
    btn.LayoutOrder = i
    tabButtons[name] = btn

    local panel = Instance.new("Frame")
    panel.Name = name .. "Panel"
    panel.Size = UDim2.new(0, Panel_W, 0, Panel_H) 
    panel.Position = UDim2.new(0, Panel_X_Start, 0, Panel_Y_Start) 
    panel.BackgroundTransparency = 1 
    panel.Visible = false
    panel.Parent = Main
    panels[name] = panel
end

panels["AutoFarm"].Visible = true
tabButtons["AutoFarm"].BackgroundColor3 = Color3.fromRGB(60,60,62)
tabButtons["AutoFarm"].BackgroundTransparency = 0.1

for name, btn in pairs(tabButtons) do
    btn.MouseButton1Click:Connect(function()
        for k,v in pairs(tabButtons) do v.BackgroundColor3 = Color3.fromRGB(44,44,46); v.BackgroundTransparency = 0.2 end
        for _,p in pairs(panels) do p.Visible = false end
        btn.BackgroundColor3 = Color3.fromRGB(60,60,62)
        btn.BackgroundTransparency = 0.1 
        panels[name].Visible = true
    end)
end

do
    local p = panels["AutoFarm"] 
    local y=6
    local label=Instance.new("TextLabel",p)
    label.Size=UDim2.new(1,0,0,24)
    label.Position=UDim2.new(0,0,0,y)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextSize = 14
    label.TextColor3 = Color3.fromRGB(220,220,220)
    label.Text="Auto Skills (spam keys)"
    y=y+30
    
    local x_start = 10
    local spacing = (Panel_W - (100 * 4 + x_start * 2)) / 3
    
    for i,key in ipairs({"Z","X","C","V"}) do
        local btn=Instance.new("TextButton",p)
        btn.Size=UDim2.new(0,100,0,32) 
        btn.Position=UDim2.new(0,x_start+(i-1)*(100+spacing),0,y)
        btn.Text=key.." OFF"
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 14
        btn.TextColor3 = Color3.fromRGB(230,230,230)
        btn.BackgroundColor3 = Color3.fromRGB(60,60,62)
        btn.BackgroundTransparency = 0.15
        btn.BorderSizePixel = 0
        Instance.new("UICorner",btn).CornerRadius = UDim.new(0,6)
        local state=false
        btn.MouseButton1Click:Connect(function()
            state=not state
            AutoSkillState[key]=state
            btn.Text=key..(state and " ON" or " OFF")
            btn.BackgroundColor3=state and Color3.fromRGB(0,170,255) or Color3.fromRGB(60,60,62)
            btn.BackgroundTransparency=state and 0.1 or 0.15
        end)
    end
end
task.spawn(function()
    while true do
        task.wait(0.5) 
        for key,enabled in pairs(AutoSkillState) do
            if enabled and not AutoFarmNPC then 
                pcall(function()
                    VirtualInputManager:SendKeyEvent(true,key,false,game)
                    task.wait(0.04)
                    VirtualInputManager:SendKeyEvent(false,key,false,game)
                end)
            end
        end
    end
end)

local AutoNPCPanel = panels["AutoNPC"]
do 
    local p = AutoNPCPanel 
    local y = 6
    local label = Instance.new("TextLabel", p)
    label.Size = UDim2.new(1, 0, 0, 24)
    label.Position = UDim2.new(0, 0, 0, y)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextSize = 14
    label.TextColor3 = Color3.fromRGB(255, 170, 0)
    label.Text = "AUTO FARM NPC (Tự động đánh quái)"
    y = y + 30

    local masterBtn = Instance.new("TextButton", p)
    masterBtn.Size = UDim2.new(0, 200, 0, 32) 
    masterBtn.Position = UDim2.new(0, 10, 0, y)
    masterBtn.Text = "Auto Farm NPC: OFF"
    masterBtn.Font = Enum.Font.GothamBold
    masterBtn.TextSize = 14
    masterBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    masterBtn.BackgroundColor3 = Color3.fromRGB(150, 50, 50) 
    masterBtn.BackgroundTransparency = 0.15
    masterBtn.BorderSizePixel = 0
    Instance.new("UICorner", masterBtn).CornerRadius = UDim.new(0, 6)

    masterBtn.MouseButton1Click:Connect(function()
        AutoFarmNPC = not AutoFarmNPC
        masterBtn.Text = "Auto Farm NPC: " .. (AutoFarmNPC and "ON" or "OFF")
        masterBtn.BackgroundColor3 = AutoFarmNPC and Color3.fromRGB(0, 150, 255) or Color3.fromRGB(150, 50, 50)
        masterBtn.BackgroundTransparency = AutoFarmNPC and 0.1 or 0.15
    end)
    y = y + 42

    local lblRange = Instance.new("TextLabel", p)
    lblRange.Size = UDim2.new(0, 250, 0, 18)
    lblRange.Position = UDim2.new(0, 10, 0, y)
    lblRange.BackgroundTransparency = 1
    lblRange.Font = Enum.Font.Gotham
    lblRange.TextSize = 12
    lblRange.TextColor3 = Color3.fromRGB(200, 200, 200)
    lblRange.Text = "Phạm vi tìm kiếm: " .. FarmRadius .. " studs (Mặc định)"
    lblRange.TextXAlignment = Enum.TextXAlignment.Left
    y = y + 24
    
    local btnInfo = Instance.new("TextLabel", p)
    btnInfo.Size = UDim2.new(1, -20, 0, 40)
    btnInfo.Position = UDim2.new(0, 10, 0, y)
    btnInfo.BackgroundTransparency = 1
    btnInfo.Font = Enum.Font.GothamBold
    btnInfo.TextSize = 12
    btnInfo.TextColor3 = Color3.fromRGB(255, 170, 170)
    btnInfo.TextXAlignment = Enum.TextXAlignment.Left
    btnInfo.Text = "CẦN LÀM: BẬT Auto Skills (Z, X, C, V) trong tab AutoFarm để sử dụng chiêu!"
    y = y + 50
end

local function findAndFarmNPC()
    local targetNPC = nil
    local shortestDistance = FarmRadius + 1

    for _, v in ipairs(workspace:GetChildren()) do
        if v:IsA("Model") and v:FindFirstChild("Humanoid") and v.Humanoid.Health > 0 then
            if v.Name ~= player.Name then 
                local npcHR = v:FindFirstChild("HumanoidRootPart")
                if npcHR and hrp then
                    local distance = (hrp.Position - npcHR.Position).Magnitude
                    if distance < shortestDistance then
                        shortestDistance = distance
                        targetNPC = npcHR
                    end
                end
            end
        end
    end

    if targetNPC then
        pcall(function()
            local direction = (hrp.Position - targetNPC.Position).Unit
            hrp.CFrame = targetNPC.CFrame * CFrame.new(0, 0, -10) 
        end)
        
        for i = 1, 3 do 
            for key, enabled in pairs(AutoSkillState) do
                if enabled then
                    pcall(function()
                        VirtualInputManager:SendKeyEvent(true, key, false, game)
                        task.wait(0.04)
                        VirtualInputManager:SendKeyEvent(false, key, false, game)
                    end)
                end
            end
            task.wait(0.3)
        end
        return true 
    end
    return false
end

task.spawn(function()
    while true do
        if AutoFarmNPC and hrp and hrp.Parent and hrp.Parent:FindFirstChildOfClass("Humanoid").Health > 0 then
            findAndFarmNPC()
        end
        task.wait(0.5) 
    end
end)

-- VÒNG LẶP GOD MODE
task.spawn(function()
    while task.wait(0.01) do
        if GodModeState and player.Character then
            local human = player.Character:FindFirstChildOfClass("Humanoid")
            if human and human.Health > 0 and human.MaxHealth > 0 then
                -- Đặt lại máu về tối đa
                human.Health = human.MaxHealth
            end
        end
    end
end)


local AutoHakiPanel = panels["AutoHaki"]
do
    local p = AutoHakiPanel 
    local lbl=Instance.new("TextLabel",p)
    lbl.Size=UDim2.new(1,0,0,24)
    lbl.Position=UDim2.new(0,0,0,6)
    lbl.BackgroundTransparency=1
    lbl.Font = Enum.Font.GothamBold
    lbl.TextSize = 14
    lbl.TextColor3 = Color3.fromRGB(220,220,220)
    lbl.Text="Auto Haki (Giữ R trong 6s, nghỉ 1s)" -- Đã cập nhật mô tả
    
    local btn=Instance.new("TextButton",p)
    btn.Size=UDim2.new(0,140,0,32) 
    btn.Position=UDim2.new(0,10,0,40)
    btn.Text="R OFF"
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.TextColor3 = Color3.fromRGB(230,230,230)
    btn.BackgroundColor3 = Color3.fromRGB(60,60,62)
    btn.BackgroundTransparency = 0.15
    btn.BorderSizePixel = 0
    Instance.new("UICorner",btn).CornerRadius=UDim.new(0,6)
    btn.MouseButton1Click:Connect(function()
        AutoHakiState=not AutoHakiState
        btn.Text="R "..(AutoHakiState and "ON" or "OFF")
        btn.BackgroundColor3=AutoHakiState and Color3.fromRGB(0,170,255) or Color3.fromRGB(60,60,62)
        btn.BackgroundTransparency=AutoHakiState and 0.1 or 0.15
    end)
end

-- VÒNG LẶP AUTO HAKI MỚI: GIỮ PHÍM THEO CHU KỲ
task.spawn(function()
    while true do
        if AutoHakiState and player.Character then
            
            -- 1. Bấm và GIỮ R (6 giây)
            pcall(function()
                VirtualInputManager:SendKeyEvent(true,"R",false,game) 
            end)
            
            task.wait(6.0) -- Giữ phím R trong 6 giây
            
            -- 2. NHẢ R
            pcall(function()
                VirtualInputManager:SendKeyEvent(false,"R",false,game)
            end)
            
            task.wait(1.0) -- Đợi 1 giây trước khi lặp lại chu kỳ
            
        else
            -- Nếu tắt, đợi ngắn hơn để giảm tải CPU
            task.wait(0.5) 
        end
    end
end)


local DropPanel = panels["Drop"]
do
    local p = DropPanel
    local y = 6
    local label = Instance.new("TextLabel", p)
    label.Size = UDim2.new(1, 0, 0, 24)
    label.Position = UDim2.new(0, 0, 0, y)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextSize = 14
    label.TextColor3 = Color3.fromRGB(0, 255, 170) 
    label.Text = "AUTO DROP ITEMS"
    y = y + 30

    local dropBtn = Instance.new("TextButton", p)
    dropBtn.Size = UDim2.new(0, 280, 0, 32) 
    dropBtn.Position = UDim2.new(0, 10, 0, y)
    dropBtn.Text = "Auto Drop Item (Đã chọn lọc): OFF"
    dropBtn.Font = Enum.Font.GothamBold
    dropBtn.TextSize = 14
    dropBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    dropBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 150) 
    dropBtn.BackgroundTransparency = 0.15
    dropBtn.BorderSizePixel = 0
    Instance.new("UICorner", dropBtn).CornerRadius = UDim.new(0, 6)
    
    dropBtn.MouseButton1Click:Connect(function()
        AutoDropItem = not AutoDropItem
        dropBtn.Text = "Auto Drop Item (Đã chọn lọc): " .. (AutoDropItem and "ON" or "OFF")
        dropBtn.BackgroundColor3 = AutoDropItem and Color3.fromRGB(0, 170, 255) or Color3.fromRGB(50, 50, 150)
        dropBtn.BackgroundTransparency = AutoDropItem and 0.1 or 0.15
    end)
    y = y + 42
    
    local note = Instance.new("TextLabel", p)
    note.Size = UDim2.new(1, -20, 0, 24) 
    note.Position = UDim2.new(0, 10, 0, y)
    note.BackgroundTransparency = 1
    note.Font = Enum.Font.Gotham
    note.TextSize = 12
    note.TextColor3 = Color3.fromRGB(255, 170, 170)
    note.TextXAlignment = Enum.TextXAlignment.Left
    note.TextWrap = true
    note.Text = "Drop fruit mix"
end

local UtilityPanel = panels["Utility"]
do
    local p = UtilityPanel
    local y = 6
    local label = Instance.new("TextLabel", p)
    label.Size = UDim2.new(1, 0, 0, 24)
    label.Position = UDim2.new(0, 0, 0, y)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextSize = 14
    label.TextColor3 = Color3.fromRGB(85, 170, 255) 
    label.Text = "CHỨC NĂNG TIỆN ÍCH KHÁC"
    y = y + 30

    -- NÚT GOD MODE
    local godModeBtn = Instance.new("TextButton", p)
    godModeBtn.Size = UDim2.new(0, 240, 0, 32) 
    godModeBtn.Position = UDim2.new(0, 10, 0, y)
    godModeBtn.Text = "God Mode (Bất Tử): OFF"
    godModeBtn.Font = Enum.Font.GothamBold
    godModeBtn.TextSize = 13
    godModeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    godModeBtn.BackgroundColor3 = Color3.fromRGB(0, 150, 50) 
    godModeBtn.BackgroundTransparency = 0.15
    godModeBtn.BorderSizePixel = 0
    Instance.new("UICorner", godModeBtn).CornerRadius = UDim.new(0, 6)
    
    godModeBtn.MouseButton1Click:Connect(function()
        GodModeState = not GodModeState
        godModeBtn.Text = "God Mode (Bất Tử): " .. (GodModeState and "ON" or "OFF")
        godModeBtn.BackgroundColor3 = GodModeState and Color3.fromRGB(50, 200, 50) or Color3.fromRGB(0, 150, 50)
        godModeBtn.BackgroundTransparency = GodModeState and 0.1 or 0.15
    end)
    y = y + 42
    
    local note = Instance.new("TextLabel", p)
    note.Size = UDim2.new(1, -20, 0, 60)
    note.Position = UDim2.new(0, 10, 0, y) 
    note.BackgroundTransparency = 1
    note.Font = Enum.Font.Gotham
    note.TextSize = 12
    note.TextColor3 = Color3.fromRGB(255, 170, 170)
    note.TextXAlignment = Enum.TextXAlignment.Left
    note.TextWrap = true
    note.Text = "God Mode: Đặt máu về tối đa liên tục (Client-Sided). An toàn khỏi NPC, nhưng không chống được Server Kill/Ban."
end


local SettingsPanel = panels["Settings"]
do
    local p = SettingsPanel
    local y = 6
    local label = Instance.new("TextLabel", p)
    label.Size = UDim2.new(1, 0, 0, 24)
    label.Position = UDim2.new(0, 0, 0, y)
    label.BackgroundTransparency = 1
    label.Font = Enum.Font.GothamBold
    label.TextSize = 14
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.Text = "TÙY CHỈNH NÚT ẨN/HIỆN HUB"
    y = y + 30
    
    -- Label hiển thị nút hiện tại
    local keyLabel = Instance.new("TextLabel", p)
    keyLabel.Name = "KeyLabel"
    keyLabel.Size = UDim2.new(0, 180, 0, 24)
    keyLabel.Position = UDim2.new(0, 10, 0, y)
    keyLabel.BackgroundTransparency = 1
    local function updateKeyLabel()
        keyLabel.Text = "Nút hiện tại: " .. tostring(Hotkey.Name)
    end
    updateKeyLabel()
    y = y + 28
    
    -- Textbox để nhập phím mới
    local keyInput = Instance.new("TextBox", p)
    keyInput.Size = UDim2.new(0, 180, 0, 32)
    keyInput.Position = UDim2.new(0, 10, 0, y)
    keyInput.PlaceholderText = "Nhập phím mới (Ví dụ: F2)"
    keyInput.Text = ""
    keyInput.Font = Enum.Font.Gotham
    keyInput.TextSize = 14
    keyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
    keyInput.BackgroundColor3 = Color3.fromRGB(40, 40, 44)
    keyInput.BackgroundTransparency = 0.15
    keyInput.TextXAlignment = Enum.TextXAlignment.Center
    Instance.new("UICorner", keyInput).CornerRadius = UDim.new(0, 6)
    y = y + 42
    
    -- Nút lưu
    local saveBtn = Instance.new("TextButton", p)
    saveBtn.Size = UDim2.new(0, 100, 0, 32)
    saveBtn.Position = UDim2.new(0, 200, 0, y - 32)
    saveBtn.Text = "LƯU PHÍM"
    saveBtn.Font = Enum.Font.GothamBold
    saveBtn.TextSize = 14
    saveBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    saveBtn.BackgroundColor3 = Color3.fromRGB(80, 150, 80)
    saveBtn.BackgroundTransparency = 0.15
    Instance.new("UICorner", saveBtn).CornerRadius = UDim.new(0, 6)
    
    saveBtn.MouseButton1Click:Connect(function()
        local newKeyName = keyInput.Text:upper()
        local success, newKey = pcall(function() return Enum.KeyCode[newKeyName] end)
        
        if success and newKey then
            Hotkey = newKey
            updateKeyLabel()
            keyInput.Text = "" 
            print("Hotkey đã được thay đổi thành: " .. tostring(Hotkey.Name))
        else
            keyInput.Text = "Phím không hợp lệ!"
            warn("Không thể thay đổi Hotkey: Phím không hợp lệ.")
            task.wait(1)
            keyInput.Text = ""
        end
    end)
    y = y + 50
    
    local note = Instance.new("TextLabel", p)
    note.Size = UDim2.new(1, -20, 0, 40)
    note.Position = UDim2.new(0, 10, 0, y)
    note.BackgroundTransparency = 1
    note.Font = Enum.Font.Gotham
    note.TextSize = 12
    note.TextColor3 = Color3.fromRGB(255, 170, 170)
    note.TextXAlignment = Enum.TextXAlignment.Left
    note.TextWrap = true
    note.Text = "Chỉ dùng phím đơn (ví dụ: F2, R, P, LeftControl, RightControl, E...)."
    y = y + 50
end

task.spawn(function()
    while true do
        if AutoDropItem then
            local itemToDrop = findDroppableItemInList()
            
            if itemToDrop then
                pcall(function()
                    itemToDrop.Parent = Character 
                    task.wait(0.01) 
                    
                    VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Backspace, false, game)
                    task.wait(0.01) 
                    VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Backspace, false, game)
                    
                    task.wait(0.1) 
                end)
            end
        end
        task.wait(0.1) 
    end
end)


local foot=Instance.new("TextLabel")
foot.Size=UDim2.new(1,0,0,16) 
foot.Position=UDim2.new(0,0,1,-16)
foot.BackgroundTransparency=1
foot.Font = Enum.Font.Gotham
foot.TextSize = 11
foot.TextColor3 = Color3.fromRGB(150,150,150)
foot.Text="NTBA • Farm Hub v20.4 (Auto Haki Hold Cycle)"
foot.Parent=Main

print("NTBA Farm Hub v20.4 - Auto Haki logic updated to Hold R for 6s, Wait 1s.")
