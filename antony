--[[
    Auto Key Presser GUI v6 - by NTBA
    ---------------------------------
    üöÄ T√≠nh nƒÉng:
      - GUI b·∫≠t/t·∫Øt auto nh·∫•n ph√≠m (Z, X, C, V, R)
      - R th√¥ng minh: t·ª± ƒë·ªông gi·ªØ khi thanh Haki ƒë·∫ßy, th·∫£ khi c·∫°n, ngh·ªâ 4 gi√¢y r·ªìi l·∫∑p l·∫°i
      - C√≥ th·ªÉ ·∫©n/hi·ªán GUI b·∫±ng ph√≠m RightControl
--]]

-- üõ† D·ªãch v·ª• Roblox
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- üåå GUI ch√≠nh
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoKeyPresserGUI"
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = game:GetService("CoreGui")

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 220, 0, 310)
frame.Position = UDim2.new(0, 50, 0, 50)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Visible = true
frame.Parent = screenGui

-- üé® Trang tr√≠ GUI
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 8)
corner.Parent = frame

local stroke = Instance.new("UIStroke")
stroke.Thickness = 1.2
stroke.Transparency = 0.6
stroke.Color = Color3.fromRGB(200, 200, 200)
stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
stroke.Parent = frame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundTransparency = 1
title.Text = "Auto Key Presser"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 22
title.Parent = frame

local author = Instance.new("TextLabel")
author.Size = UDim2.new(1, 0, 0, 20)
author.Position = UDim2.new(0, 0, 1, -25)
author.BackgroundTransparency = 1
author.Text = "T√°c gi·∫£: NTBA"
author.TextColor3 = Color3.fromRGB(150, 150, 150)
author.Font = Enum.Font.SourceSansItalic
author.TextSize = 16
author.Parent = frame

-- üéÆ Danh s√°ch ph√≠m
local keys = {"Z", "X", "C", "V", "R"}
local toggles = {}

-- üîÅ Auto nh·∫•n ph√≠m Z, X, C, V
local function autoPress(key)
    while toggles[key] do
        VirtualInputManager:SendKeyEvent(true, key, false, game)
        task.wait(0.1)
        VirtualInputManager:SendKeyEvent(false, key, false, game)
        task.wait(0.5)
    end
end

-- üñ≤Ô∏è T·∫°o n√∫t toggle trong GUI
for i, key in ipairs(keys) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(1, -20, 0, 40)
    btn.Position = UDim2.new(0, 10, 0, 40 * i + 10)
    btn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
    btn.BorderSizePixel = 0
    btn.TextColor3 = Color3.fromRGB(255, 255, 255)
    btn.Font = Enum.Font.SourceSans
    btn.TextSize = 20
    btn.Text = key .. ": OFF"
    btn.Parent = frame

    toggles[key] = false

    btn.MouseButton1Click:Connect(function()
        toggles[key] = not toggles[key]
        btn.Text = key .. ": " .. (toggles[key] and "ON" or "OFF")

        if key ~= "R" and toggles[key] then
            task.spawn(function() autoPress(key) end)
        end
    end)
end

-- ‚ö° Auto gi·ªØ/th·∫£ R theo thanh Haki
local isRHeld = false
local waitDelay = 4 -- ngh·ªâ 4 gi√¢y tr∆∞·ªõc khi nh·∫•n l·∫°i

RunService.Heartbeat:Connect(function()
    if toggles["R"] then
        local bar = player.PlayerGui:FindFirstChild("PressQ_Haki")
        if bar then
            local healthBar = bar:FindFirstChild("HealthBar")
            if healthBar and healthBar:FindFirstChild("Frame") and healthBar.Frame:FindFirstChild("Haki") then
                local hakiBar = healthBar.Frame.Haki
                if hakiBar:IsA("Frame") then
                    local percent = hakiBar.Size.X.Scale

                    -- N·∫øu full ‚Üí gi·ªØ R
                    if percent >= 0.99 and not isRHeld then
                        VirtualInputManager:SendKeyEvent(true, "R", false, game)
                        isRHeld = true

                    -- N·∫øu g·∫ßn h·∫øt ‚Üí th·∫£ R v√† ngh·ªâ 4 gi√¢y
                    elseif percent <= 0.05 and isRHeld then
                        VirtualInputManager:SendKeyEvent(false, "R", false, game)
                        isRHeld = false
                        task.wait(waitDelay)
                    end
                end
            end
        end
    else
        if isRHeld then
            VirtualInputManager:SendKeyEvent(false, "R", false, game)
            isRHeld = false
        end
    end
end)

-- ‚å®Ô∏è ·∫®n/hi·ªán GUI b·∫±ng RightControl
local lastToggle = 0
RunService.Heartbeat:Connect(function()
    if UserInputService:IsKeyDown(Enum.KeyCode.RightControl) then
        if tick() - lastToggle > 0.3 then
            frame.Visible = not frame.Visible
            lastToggle = tick()
        end
    end
end)
