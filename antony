-- Xo√° GUI c≈© n·∫øu t·ªìn t·∫°i
local player = game.Players.LocalPlayer
local old = player:FindFirstChild("PlayerGui"):FindFirstChild("FarmUI")
if old then old:Destroy() end

-- Services
local TweenService = game:GetService("TweenService")
local GuiService = game:GetService("GuiService")
local VirtualInputManager = game:GetService("VirtualInputManager")
local RunService = game:GetService("RunService")

-- Main GUI
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "FarmUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = player:WaitForChild("PlayerGui")

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0,450,0,220)
MainFrame.Position = UDim2.new(0.5,-225,0.1,0)
MainFrame.BackgroundColor3 = Color3.fromRGB(245,245,245)
MainFrame.BackgroundTransparency = 0.15 -- h∆°i trong su·ªët
MainFrame.BorderSizePixel = 0
MainFrame.Parent = ScreenGui

local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0,15)
corner.Parent = MainFrame

-- Tab Bar
local TabBar = Instance.new("Frame")
TabBar.Size = UDim2.new(1,0,0,40)
TabBar.Position = UDim2.new(0,0,0,0)
TabBar.BackgroundColor3 = Color3.fromRGB(230,230,230)
TabBar.BackgroundTransparency = 0.2
TabBar.BorderSizePixel = 0
TabBar.Parent = MainFrame

local tabCorner = Instance.new("UICorner")
tabCorner.CornerRadius = UDim.new(0,12)
tabCorner.Parent = TabBar

-- Content Holder
local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1,0,1,-40)
ContentFrame.Position = UDim2.new(0,0,0,40)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- Tabs setup
local tabs = { {Name="Farm Fruit", Icon="üçé"}, {Name="Farm Haki", Icon="‚ö°"} }
local buttons = {}
local currentTab = nil

local function switchTab(tabName)
    for name, btn in pairs(buttons) do
        local colorGoal = (name==tabName) and Color3.fromRGB(0,170,255) or Color3.fromRGB(60,60,60)
        TweenService:Create(btn,TweenInfo.new(0.3,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),{BackgroundColor3=colorGoal}):Play()
        btn.TextColor3 = (name==tabName) and Color3.fromRGB(255,255,255) or Color3.fromRGB(200,200,200)
    end
    currentTab = tabName

    for _, child in ipairs(ContentFrame:GetChildren()) do
        if child:IsA("Frame") then
            local goalY = (child.Name == tabName.."Content") and 0 or 20
            TweenService:Create(child,TweenInfo.new(0.3,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),{Position=UDim2.new(0,0,0,goalY)}):Play()
        end
    end
end

-- Create tab buttons
for i, tab in ipairs(tabs) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0.5,0,1,0)
    btn.Position = UDim2.new((i-1)*0.5,0,0,0)
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.BorderSizePixel = 0
    btn.Font = Enum.Font.GothamBold
    btn.Text = tab.Icon.." "..tab.Name
    btn.TextSize = 16
    btn.TextColor3 = Color3.fromRGB(200,200,200)
    btn.Parent = TabBar
    buttons[tab.Name] = btn

    btn.MouseButton1Click:Connect(function() switchTab(tab.Name) end)

    -- Hover effect
    btn.MouseEnter:Connect(function()
        TweenService:Create(btn,TweenInfo.new(0.2,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),{BackgroundColor3=Color3.fromRGB(0,170,255)}):Play()
    end)
    btn.MouseLeave:Connect(function()
        local colorGoal = (currentTab==tab.Name) and Color3.fromRGB(0,170,255) or Color3.fromRGB(60,60,60)
        TweenService:Create(btn,TweenInfo.new(0.2,Enum.EasingStyle.Quad,Enum.EasingDirection.Out),{BackgroundColor3=colorGoal}):Play()
    end)
end

-- Content frames
local fruitFrame = Instance.new("Frame")
fruitFrame.Size = UDim2.new(1,0,1,0)
fruitFrame.Position = UDim2.new(0,0,0,0)
fruitFrame.BackgroundTransparency = 1
fruitFrame.Visible = true
fruitFrame.Name = "Farm FruitContent"
fruitFrame.Parent = ContentFrame

local hakiFrame = Instance.new("Frame")
hakiFrame.Size = UDim2.new(1,0,1,0)
hakiFrame.Position = UDim2.new(0,0,0,20)
hakiFrame.BackgroundTransparency = 1
hakiFrame.Visible = true
hakiFrame.Name = "Farm HakiContent"
hakiFrame.Parent = ContentFrame

switchTab("Farm Fruit")

-- Fruit buttons Z/X/C/V
local fruitKeys = {"Z","X","C","V"}
local fruitToggles = {}
for i,key in ipairs(fruitKeys) do
    local btn = Instance.new("TextButton")
    btn.Size = UDim2.new(0,80,0,40)
    btn.Position = UDim2.new(0,20+(i-1)*90,0,50)
    btn.BackgroundColor3 = Color3.fromRGB(60,60,60)
    btn.BorderSizePixel = 0
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 18
    btn.Text = key.." OFF"
    btn.TextColor3 = Color3.fromRGB(200,200,200)
    btn.Parent = fruitFrame
    local state = false
    btn.MouseButton1Click:Connect(function()
        state = not state
        btn.Text = key.." "..(state and "ON" or "OFF")
        btn.BackgroundColor3 = state and Color3.fromRGB(0,170,255) or Color3.fromRGB(60,60,60)
        fruitToggles[key] = state
    end)
    fruitToggles[key] = state
end

-- Haki R button
local hakiBtn = Instance.new("TextButton")
hakiBtn.Size = UDim2.new(0,100,0,40)
hakiBtn.Position = UDim2.new(0,20,0,50)
hakiBtn.BackgroundColor3 = Color3.fromRGB(60,60,60)
hakiBtn.BorderSizePixel = 0
hakiBtn.Font = Enum.Font.GothamBold
hakiBtn.TextSize = 18
hakiBtn.Text = "R OFF"
hakiBtn.TextColor3 = Color3.fromRGB(200,200,200)
hakiBtn.Parent = hakiFrame
local hakiToggle = false
hakiBtn.MouseButton1Click:Connect(function()
    hakiToggle = not hakiToggle
    hakiBtn.Text = "R "..(hakiToggle and "ON" or "OFF")
    hakiBtn.BackgroundColor3 = hakiToggle and Color3.fromRGB(0,170,255) or Color3.fromRGB(60,60,60)
end)

-- Farming logic
task.spawn(function()
    while task.wait(0.1) do
        if GuiService.MenuIsOpen then continue end

        if currentTab == "Farm Fruit" then
            for key,state in pairs(fruitToggles) do
                if state then
                    VirtualInputManager:SendKeyEvent(true,key,false,game)
                    task.wait(0.05)
                    VirtualInputManager:SendKeyEvent(false,key,false,game)
                end
            end
        elseif currentTab == "Farm Haki" then
            if hakiToggle then
                VirtualInputManager:SendKeyEvent(true,Enum.KeyCode.R,false,game)
                task.wait(8)
                VirtualInputManager:SendKeyEvent(false,Enum.KeyCode.R,false,game)
                task.wait(1)
            end
        end
    end
end)
